<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>ios支付，服务端测试用例</title>
    <!--mark |wiz_custom_css| for wizeditor replace it-->


<style id="wiz_custom_css">        html, body {            font-size: 15px;        }        body {            font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;            line-height: 1.6;            margin: 0;            padding: 20px 36px;            padding: 1.33rem 2.4rem;        }        h1, h2, h3, h4, h5, h6 {            margin: 20px 0 10px;            margin: 1.33rem 0 0.667rem;            padding: 0;            font-weight: bold;        }        h1 {            font-size: 21px;            font-size: 1.4rem;        }        h2 {            font-size: 20px;            font-size: 1.33rem;        }        h3 {            font-size: 18px;            font-size: 1.2rem;        }        h4 {            font-size: 17px;            font-size: 1.13rem;        }        h5 {            font-size: 15px;            font-size: 1rem;        }        h6 {            font-size: 15px;            font-size: 1rem;            color: #777777;            margin: 1rem 0;        }        div, p, ul, ol, dl, li {            margin: 0;        }        blockquote, table, pre, code {            margin: 8px 0;        }        ul, ol {            padding-left: 32px;            padding-left: 2.13rem;        }        blockquote {            padding: 0 12px;            padding: 0 0.8rem;        }        blockquote > :first-child {            margin-top: 0;        }        blockquote > :last-child {            margin-bottom: 0;        }        img {            border: 0;            max-width: 100%;            height: auto !important;            margin: 2px 0;        }        table {            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        td {            padding: 4px 8px;            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        @media screen and (max-width: 660px) {            body {                padding: 20px 18px;                padding: 1.33rem 1.2rem;            }        }        @media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) {            html, body {                font-size: 17px;            }            body {                line-height: 1.7;                padding: 0.75rem 0.9375rem;                color: #353c47;            }            h1 {                font-size: 2.125rem;            }            h2 {                font-size: 1.875rem;            }            h3 {                font-size: 1.625rem;            }            h4 {                font-size: 1.375rem;            }            h5 {                font-size: 1.125rem;            }            h6 {                color: inherit;            }            ul, ol {                padding-left: 2.5rem;            }            blockquote {                padding: 0 0.9375rem;            }        }</style><style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head>

<body  style=""><pre style="font-family: 宋体; font-size: 15pt;"><span style="background-color: rgb(255, 255, 255);"></span></pre><pre style="font-family: 宋体; font-size: 15pt;"><font style="background-color: rgb(255, 255, 255);"></font></pre><pre style="font-family: 宋体; font-size: 15pt;"><span style="background-color: rgb(255, 255, 255);"></span></pre><pre><pre style="color: rgb(169, 183, 198); font-family: 宋体; font-size: 15pt;"><span style="color: rgb(128, 128, 128); background-color: rgb(255, 255, 255);">ios客服端冲值成功后返回的数据，然后发给服务端验证:</span></pre><pre style="color: rgb(169, 183, 198); font-family: 宋体; font-size: 15pt;"><span style="background-color: rgb(255, 255, 255);"><span style="color:#808080;"><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">//diamond_910#1000000261536382#</span><br style="font-size: 0.8rem;"></span><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">str :=</span><span style="color:#6a8759;"><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">"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"</span><br></span></span></pre></pre><h4><span style="font-weight: normal;"><span style="background-color: rgb(255, 255, 255);"><font face="宋体" size="5"><span style="line-height: 32px;"><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">验证后返回的结果如下：<br></span></span></font></span><span style="background-color: rgb(255, 255, 255);"><font face="宋体" size="5"><span style="line-height: 32px;"><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">{"status":0, "environment":"Sandbox",<br> </span></span></font></span><span style="background-color: rgb(255, 255, 255);"><font face="宋体" size="5"><span style="line-height: 32px;"><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">"receipt":{"receipt_type":"ProductionSandbox", "adam_id":0, "app_item_id":0, "bundle_id":"com.clhy.zhanjian", "application_version":"0", "download_id":0, "version_external_identifier":0, "receipt_creation_date":"2016-12-27 03:05:03 Etc/GMT", "receipt_creation_date_ms":"1482807903000", "receipt_creation_date_pst":"2016-12-26 19:05:03 America/Los_Angeles", "request_date":"2016-12-28 08:59:40 Etc/GMT", "request_date_ms":"1482915580180", "request_date_pst":"2016-12-28 00:59:40 America/Los_Angeles", "original_purchase_date":"2013-08-01 07:00:00 Etc/GMT", "original_purchase_date_ms":"1375340400000", "original_purchase_date_pst":"2013-08-01 00:00:00 America/Los_Angeles", "original_application_version":"1.0", <br></span></span></font></span><span style="background-color: rgb(255, 255, 255);"><font face="宋体" size="5"><span style="line-height: 32px;"><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">"in_app":[<br></span></span></font></span><span style="background-color: rgb(255, 255, 255);"><font face="宋体" size="5"><span style="line-height: 32px;"><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">{"quantity":"1", "product_id":"diamond_910", "transaction_id":"1000000261536382", "original_transaction_id":"1000000261536382", "purchase_date":"2016-12-27 03:05:03 Etc/GMT", "purchase_date_ms":"1482807903000", "purchase_date_pst":"2016-12-26 19:05:03 America/Los_Angeles", "original_purchase_date":"2016-12-27 03:05:03 Etc/GMT", "original_purchase_date_ms":"1482807903000", "original_purchase_date_pst":"2016-12-26 19:05:03 America/Los_Angeles", "is_trial_period":"false"},<br> </span></span></font></span><span style="background-color: rgb(255, 255, 255);"><font face="宋体" size="5"><span style="line-height: 32px;"><span data-wiz-span="data-wiz-span" style="font-size: 0.8rem;">{"quantity":"1", "product_id":"diamond_3420", "transaction_id":"1000000260640988", "original_transaction_id":"1000000260640988", "purchase_date":"2016-12-21 06:50:09 Etc/GMT", "purchase_date_ms":"1482303009000", "purchase_date_pst":"2016-12-20 22:50:09 America/Los_Angeles", "original_purchase_date":"2016-12-21 06:50:09 Etc/GMT", "original_purchase_date_ms":"1482303009000", "original_purchase_date_pst":"2016-12-20 22:50:09 America/Los_Angeles", "is_trial_period":"false"}]}}</span></span></font></span></span></h4><div><br></div><pre style="font-family: 宋体; font-size: 15pt;"><b>golang 代码如下：</b></pre><pre style="font-family: 宋体; font-size: 15pt;"><span style="background-color: rgb(255, 255, 255);"><span style="font-weight: bold;">func </span>(self *User ) verifyAndExchange(receipt string,receipt_base64 string,uniqueId string,tplId string) PBRetCode.RetCode {<br><br>       //Rpc check<br>       result,err := rpc.CheckIpaRepeat(receipt,uniqueId,self.Id)<br>       <span style="font-weight: bold;">if </span>err != nil || result == nil || result.OK != 0   {<br>              logger.Error("rpc error CheckIpaRepeat ok:%v,err:%v",result,err)<br>              <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_ipa_orderexist<br></span><span style="font-style: italic;">       </span>}<br><br>       data := "{\"receipt-data\":\"" + receipt_base64+"\"}"<br>       ios_return := PostSSlUrl(url_verify,data)<br>       <span style="font-weight: bold;">if </span>ios_return == nil{<br>              logger.Error("1 ios_return is nil,%v,%v",uniqueId,ios_return)<br>              <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_ipa_timeOut<br></span><span style="font-style: italic;">       </span>}<br>       status := ios_return.Status<br><br>       //如果是 status=21007，那么表示是沙河测试<br>       <span style="font-weight: bold;">if </span>status == 21007 {<br>              ios_return = PostSSlUrl(url_sandbox,data)<br>              <span style="font-weight: bold;">if </span>ios_return == nil{<br>                     logger.Error("2 ios_return is nil,%v,%v",uniqueId,ios_return)<br>                     <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_ipa_timeOut<br></span><span style="font-style: italic;">              </span>}<br>              status = ios_return.Status<br>       }<br><br>       <span style="font-weight: bold;">if </span>status != 0 {<br>              logger.Error("status is not 0,status:%v",status)<br>              <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_system<br></span><span style="font-style: italic;">       </span>}<br><br>       mallTpl := mall.GetMallTpl(tools.CoverToUint32(tplId))<br>       //testmallTpl := mall.GetMallTpl(5)<br>       <span style="font-weight: bold;">if </span>mallTpl == nil {<br>              logger.Error("mallTpl  is nil:%v",tplId)<br>              <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_system<br></span><span style="font-style: italic;">       </span>}<br><br>       appInfo := ios_return.Receipt.GetInAppInfo(uniqueId)<br>       <span style="font-weight: bold;">if </span>appInfo == nil {<br>              logger.Error("uniqueId is not exit in InAppInfo",uniqueId)<br>              <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_system<br></span><span style="font-style: italic;">       </span>}<br>       payTime  := int32(tools.CoverToInt64(appInfo.Purchase_date_ms)/1000)<br><br>       //完成记录<br>       //uniqueId string,tplId string,userId int32,time int32<br>       resultFinish,errFinish := rpc.FinishIpaRay(uniqueId,mallTpl.GetPrice()*100,self.Id,payTime)<br>       <span style="font-weight: bold;">if </span>errFinish != nil || resultFinish == nil || result.OK != 0   {<br>              logger.Error("rpc error FinishIpaRay ok:%v,err:%v",result,err)<br>              <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_system<br></span><span style="font-style: italic;">       </span>}<br><br>       csMgs := &amp;PBUser.IpaVerifyAck{Ret:PBRetCode.<span style="font-style: italic;">RetCode_er_none</span>.Enum(),Receipt:proto.String(uniqueId)}<br>       p,err2 := common.PackMsg(csMgs)<br>       <span style="font-weight: bold;">if </span>err2 != nil {<br>              logger.Error("1 IpaVerifyAck  PackMsg err :%v", err2)<br>              <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_system<br></span><span style="font-style: italic;">       </span>}<br>       self.SendToClient(gp.<span style="font-style: italic;">Game_Message</span>,p)<br>       <span style="font-weight: bold;">return </span>PBRetCode.<span style="font-style: italic;">RetCode_er_none<br></span>}<br><br><span style="font-weight: bold;">func </span>PostSSlUrl(url string,data string) *IpaData{<br>       tr := &amp;http.Transport {<br>              TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},<br>       }<br>       client := &amp;http.Client{Transport: tr,Timeout:time.<span style="font-style: italic;">Second</span>*10}<br><br>       resp, err1 := client.Post(url,"text/json",strings.NewReader(data)) //PostForm(url,data) //https://sandbox.itunes.apple.com/verifyReceipt")<br>       <span style="font-weight: bold;">if </span>err1 != nil {<br>              logger.Error("Post error:", err1)<br>              <span style="font-weight: bold;">return </span>nil<br>       }<br>       <span style="font-weight: bold;">if </span>resp.StatusCode != http.<span style="font-style: italic;">StatusOK </span>{<br>              logger.Error("ERROR_STATUS_NOT_OK statusCode:%v",resp.StatusCode)<br>              <span style="font-weight: bold;">return </span>nil<br>       }<br><br>       <span style="font-weight: bold;">defer </span>resp.Body.Close()<br>       body, err2 := ioutil.ReadAll(resp.Body)<br>       <span style="font-weight: bold;">if </span>err2 != nil {<br>              fmt.Println("ReadAll body error:", err2)<br>              <span style="font-weight: bold;">return </span>nil<br>       }<br><br>       logger.Debug("verify return bodyData================:%v",string(body))<br><br>       //ios_return := make(map[string]interface{},0)<br>       ios_return := &amp;IpaData{}<br>       err3 := ffjson.Unmarshal([]byte(string(body)),ios_return)<br>       <span style="font-weight: bold;">if </span>err3 != nil {<br>              logger.Error("err2 Unmarshal err:%v,data :%v",err3,string(body))<br>              <span style="font-weight: bold;">return  </span>nil<br>       }<br><br>       <span style="font-weight: bold;">return </span>ios_return<br>}<br><br><br><br><br><br><span style="font-weight: bold;">type </span>IpaData <span style="font-weight: bold;">struct </span>{<br>       Status int32  `json:"status"`<br>       Receipt ReceiptInfo  `json:"receipt"`<br>       Environment string `json:"environment"`<br>}<br><br><span style="font-weight: bold;">type </span>ReceiptInfo <span style="font-weight: bold;">struct </span>{<br>       Receipt_type string `json:"receipt_type"`<br>       App_item_id int32 `json:"app_item_id"`<br>       Bundle_id string `json:"bundle_id"`<br>       In_app []*InAppInfo `json:"in_app"`<br>}<br><br><span style="font-weight: bold;">func </span>(self ReceiptInfo) GetInAppInfo(transaction_id string) *InAppInfo {<br>       <span style="font-weight: bold;">if </span>self.In_app == nil{<br>              logger.Error("self.In_app is nil")<br>              <span style="font-weight: bold;">return </span>nil<br>       }<br>       <span style="font-weight: bold;">for </span>_,v :=<span style="font-weight: bold;">range </span>self.In_app{<br>              <span style="font-weight: bold;">if </span>v.Transaction_id == transaction_id {<br>                     <span style="font-weight: bold;">return </span>v<br>              }<br>       }<br>       <span style="font-weight: bold;">return </span>nil<br>}<br><br><span style="font-weight: bold;">type </span>InAppInfo <span style="font-weight: bold;">struct </span>{<br>       Auantity string `json:"quantity"`<br>       Product_id string `json:"product_id"`<br>       Transaction_id string `json:"transaction_id"`<br>       Original_purchase_date string `json:"original_purchase_date"`<br>       Purchase_date string `json:"purchase_date"`<br>       Purchase_date_ms string `json:"purchase_date_ms"`<br>}</span></pre></body></html>