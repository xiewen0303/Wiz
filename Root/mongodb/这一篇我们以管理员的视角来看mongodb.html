<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--defaultCSS-->
<title>这一篇我们以管理员的视角来看mongodb</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: 微软雅黑,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>

<style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked {  color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style></head>

<body  style=""><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">这一篇我们以管理员的视角来看mongodb，作为一名管理员，我们经常接触到的主要有4个方面：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">1．&nbsp; 安装部署</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">2．&nbsp; 状态监控</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">3．&nbsp; 安全认证</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">4．&nbsp; 备份和恢复，</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">下面我们就一点一点的讲解。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">一：安装部署</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; &nbsp; 我之前的文章都是采用console程序来承载，不过在生产环境中这并不是最佳实践，谁也不愿意在机器重启后满地找牙似找mongodb，</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">在mongodb里面提供了一个叫做“服务寄宿”的模式，我想如果大家对wcf比较熟悉的话很容易听懂。好了，我们实践一下，这里我开一下D盘</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">里面的mongodb。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/fb93d25f-8e65-4b92-b463-93d3295d75e9.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">这里要注意的有两点：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp;&lt;1&gt; logpath: 当我们使用服务寄宿的时候，用眼睛都能想明白肯定不会用console来承载日志信息了。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp;&lt;2&gt; install: &nbsp; 开启安装服务寄宿，很happy啊，把管理员的手工操作降低到最小，感谢mongodb。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">好了，console程序叫我看log日志，那我就看看，发现mongodb已经提示我们如何开启mongodb，接着我照做就是了。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/baf5b61c-bdf2-480a-b19b-78f664a56674.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">还要提醒大家一点的就是，这些命令参数很多很复杂也就很容易忘，不过没关系，数据库给我们提供了一个help方法，我们可以</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">拿mongod和mongo说事。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">mongod：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/d4350c9b-f210-43a8-8e6c-77934ed917db.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">mongo：</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/6da9b53c-9998-4083-93ce-1bebd26da347.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">二：状态监控</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp;监控可以让我们实时的了解数据库的健康状况以及性能调优，在mongodb里面给我们提供了三种方式。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">1：http监视器</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp;这个我在先前的文章中也提到了，这里就不赘述了。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">2：serverStatus()</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 这个函数可以获取到mongodb的服务器统计信息，其中包括 ：全局锁，索引，用户操作行为等等这些统计信息，对管理员来说非常</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 重要，具体的参数含义可以参考园友：<a href="http://www.cnblogs.com/xuegang/archive/2011/10/13/2210339.html" style="margin: 0px; padding: 1px 3px; color: green; text-decoration: none;">http://www.cnblogs.com/xuegang/archive/2011/10/13/2210339.html</a></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 这里还是截个图混个眼熟。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/753d006e-9ae8-47a1-9f3c-88cff8d17439.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">3：mongostat</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; 前面那些统计信息再牛X，那也是静态统计，不能让我观看实时数据变化，还好，mongodb里面提供了这里要说的mongodstat</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">监视器，这玩意会每秒刷新，在实际生产环境中大有用处，还是截张图，很有意思，是不是感觉大军压境了。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/53910f99-1f5b-44c5-80a7-5833a14e9745.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">三:&nbsp;安全认证</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp;作为数据库软件，我们肯定不想谁都可以访问，为了确保数据的安全，mongodb也会像其他的数据库软件一样可以采用用户</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">验证的方法，那么该怎么做呢？其实很简单，mongodb提供了addUser方法，还有一个注意点就是如果在admin数据库中添加</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">将会被视为“超级管理员”。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/0480295c-cc24-4f66-bd37-38645b3fbf43.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">上面的admin用户将会被视为超级管理员，“jack”用户追加的第三个参数表示是否是“只读用户”，好了，该添加的我们都添加了，</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">我们第一次登录时不是采用验证模式，现在我们使用--reinstall重启服务并以--auth验证模式登录。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/6bef085a-ba78-4f03-a0d1-47097ebea093.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">好了，我们进入test集合翻翻数据看看情况，我们发现jack用户始终都是没有写入的权限，不管是授权或者未授权。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/49ae8e47-20db-4fec-ba6f-9c0b8eb1c3b5.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">四：备份和恢复</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; 这玩意的重要性我想都不需要我来说了吧，这玩意要是搞不好会死人的,mongodb里面常用的手段有3种。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">1： 直接copy</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; &nbsp;这个算是最简单的了，不过要注意一点，在服务器运行的情况下直接copy是很有风险的，可能copy出来时，数据已经遭到</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; &nbsp; 破坏，唯一能保证的就是要暂时关闭下服务器，copy完后重开。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">2：mongodump和mongorestore</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; 这个是mongo给我们提供的内置工具，很好用，能保证在不关闭服务器的情况下copy数据。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">为了操作方便，我们先删除授权用户。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/b6129bdf-860a-456f-86c6-f12779a8b111.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">好了，我们转入正题，这里我先在D盘建立一个backup文件夹用于存放test数据库。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/26746838-a552-4dde-9484-44eeb9bcf53e.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">快看，数据已经备份过来了，太爽了，现在我们用mongorestore恢复过去，记住啊，它是不用关闭机器的。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);"><img src="这一篇我们以管理员的视角来看mongodb_files/a4a4ab6e-5ce3-4174-adc9-785adb273d1c.png" alt="" style="margin: 0px; padding: 0px; max-width: 1000px;"></p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">提一点的就是 drop选项，这里是说我将test数据恢复之前先删除原有数据库里面的数据，同样大家可以通过help查看。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">3：主从复制</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; &nbsp;这个我在上上篇有所介绍，这里也不赘述了。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 其实上面的1，2两点都不能保证获取数据的实时性，因为我们在备份的时候可能还有数据灌在内存中不出来，那么我们</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">想说能不能把数据暴力的刷到硬盘上，当然是可以的,mongodb给我们提供了fsync+lock机制就能满足我们提的需求。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">fsync+lock首先会把缓冲区数据暴力刷入硬盘，然后给数据库一个写入锁，其他实例的写入操作全部被阻塞，直到fsync</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">+lock释放锁为止。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">这里就不测试了。</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;加锁： &nbsp; &nbsp;db.runCommand({"fsync":1,"lock":1})</p><p style="margin: 10px auto; padding: 0px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; widows: 1; background-color: rgb(255, 255, 255);">&nbsp;释放锁： db.$cmd.unlock.findOne()</p><br><div style="color:gray"><small>来源：&nbsp;&lt;<a href="http://www.cnblogs.com/huangxincheng/archive/2012/03/08/2384571.html">http://www.cnblogs.com/huangxincheng/archive/2012/03/08/2384571.html</a><small>&gt;</small></small></div><small><small>&nbsp;</small></small></body></html>